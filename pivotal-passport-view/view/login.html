<!DOCTYPE html>
<html>
<head>
    <script>
        if (window !== top) top.location.replace(location.href);
    </script>
    <meta charset="utf-8"/>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport"/>
    <link href="../resources/icons/pivotal-cloud.ico" rel="icon"/>
    <title>登录 - PivotalCloud统一登录平台</title>
    <link href="../component/layui-2.5.5/dist/css/layui.css" rel="stylesheet"/>
    <link href="../component/easyweb-3.1.7/dist/admin.css" rel="stylesheet"/>
    <link href="../public/css/passport-ui.css" rel="stylesheet">
</head>
<body>
<div class="login-wrapper">
    <div class="layui-form">
        <h2>PivotalCloud统一登录平台</h2>
        <div class="layui-form-item layui-input-icon-group">
            <i class="layui-icon layui-icon-username"></i>
            <select id="tenantCode" name="tenantCode">
                <option value="">请选择平台标识</option>
                <option value="console">管控平台</option>
                <option value="monitor">监控平台</option>
                <option value="mall">商城平台</option>
                <option value="portal">门户平台</option>
                <option value="podcast">播客平台</option>
                <option value="blogger">博客平台</option>
                <option value="manager">系统平台</option>
            </select>
        </div>
        <div class="layui-form-item layui-input-icon-group">
            <i class="layui-icon layui-icon-username"></i>
            <input autocomplete="off" class="layui-input" id="username" lay-verType="tips" lay-verify="required" name="username" placeholder="请输入登录账号" required value="admin"/>
        </div>
        <div class="layui-form-item layui-input-icon-group">
            <i class="layui-icon layui-icon-password"></i>
            <input class="layui-input" id="password" lay-verType="tips" lay-verify="required" name="password" placeholder="请输入登录密码" required type="password" value="111111"/>
        </div>
        <div class="layui-form-item layui-input-icon-group login-captcha-group">
            <i class="layui-icon layui-icon-auz"></i>
            <input autocomplete="off" class="layui-input" id="kaptcha" lay-verType="tips" lay-verify="required" placeholder="请输入验证码" required/>
            <img alt="" class="login-captcha" src=""/>
        </div>

        <div class="layui-form-item">
            <input checked lay-skin="primary" name="remember" title="记住密码" type="checkbox">
            <a class="layui-link pull-right" href="javascript:;">注册账号</a>
        </div>
        <div class="layui-form-item">
            <button class="layui-btn layui-btn-fluid" id="submit">登录</button>
        </div>
        <div class="layui-form-item login-oauth-group text-center">
            <a href=""><i class="layui-icon layui-icon-login-qq" style="color: #3492ed"></i></a>&emsp;
            <a href="${ctxPath}/oauth/render/gitee">
                <img class="layui-icon" src="../assets/expand/images/git.png" style="height: 28px; width: 28px; margin-top: -12px !important"/>
            </a>
        </div>
    </div>
</div>
<div class="login-copyright">
    Copyright © 2018-2020 Pivotal Cloud all rights reserved.
</div>


<!-- js部分 -->
<script src="../component/layui-2.5.5/dist/layui.js" type="text/javascript"></script>

<script>
    layui.use(['layer', 'form', 'index', 'ax', 'notice'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var form = layui.form;
        var $ax = layui.ax;
        var index = layui.index;
        var notice = layui.notice;

        /* 图形验证码 */
        $('img.login-captcha').click(function () {
            this.src = this.src + '?t=' + (new Date).getTime();
        });

        var errorMsg = "${tips!}";
        if (errorMsg) {
            layer.msg(errorMsg, {icon: 5, anim: 6});
        }

        //初始化租户列表
        var ajax = new $ax(Feng.ctxPath + "/tenantInfo/listTenants", function (data) {
            for (var i = 0; i < data.data.length; i++) {
                var name = data.data[i].name;
                var code = data.data[i].code;
                $("#tenantCode").append('<option value="' + code + '">' + name + '</option>');
            }
            form.render();
        }, function (data) {
        });
        ajax.start();

        //登录操作
        $('#submit').click(function () {
            var ajax = new $ax(Feng.ctxPath + "/login", function (data) {
                Feng.success("登录成功!");
                index.clearTabCache();
                window.location.href = Feng.ctxPath + "/";
            }, function (data) {
                layer.msg("登录失败！" + data.responseJSON.message, {icon: 5, anim: 6});
            });
            ajax.set("username", $("#username").val());
            ajax.set("password", $("#password").val());
            ajax.set("tenantCode", $("#tenantCode").val());
            ajax.set("kaptcha", $("#kaptcha").val());
            ajax.start();
        });

    });
</script>
</body>
</html>
